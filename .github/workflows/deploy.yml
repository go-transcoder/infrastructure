
name: deploy
run-name: provision the infrastructure
on:
  push:
    branches:
      - main
jobs:

  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Create the .vault_pass file
        env:
          VAULT_PASSWORD_FILE: ${{ secrets.VAULT_PASS }}
        run: |
          touch .vault_pass
          echo $VAULT_PASSWORD_FILE >> .vault_pass

      - name: Run Ansible playbook
        run: |
          ansible-playbook -i provisioning/environments/prod/ --vault-password-file .vault_pass  provisioning/playbook.yml